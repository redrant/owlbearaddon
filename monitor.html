<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/@owlbear-rodeo/sdk/dist/obr.js"></script>
    <style>
        :root { 
            --p: #bb86fc; --bg: #0d0d0f; --surf: #16161a; --t: #f0f0f0; 
            --crit: #00ff88; --fail: #ff4466; --accent: #03dac6;
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { 
            background: var(--bg); color: var(--t); margin: 0; padding: 10px;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }
        
        .header { 
            padding: 8px; text-align: center; border-bottom: 1px solid #333; 
            background: var(--surf); border-radius: 8px 8px 0 0; flex-shrink: 0;
        }
        .sig { font-size: 11px; font-weight: bold; color: var(--p); text-shadow: 0 0 8px var(--p); letter-spacing: 1px; }

        .log-container { 
            flex: 1; overflow-y: auto; padding: 10px 5px; display: flex; flex-direction: column; gap: 8px;
        }

        .log-entry {
            background: var(--surf); border: 1px solid #252529; border-left: 3px solid var(--p);
            padding: 10px; border-radius: 6px; font-size: 13px; line-height: 1.4;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .dash-name { color: var(--p); font-weight: bold; }
        .formula { color: #888; font-family: monospace; font-size: 11px; }
        .result-val { font-size: 18px; font-weight: 900; color: var(--t); margin-left: 5px; }
        .details { display: block; font-size: 10px; color: #555; margin-top: 4px; border-top: 1px solid #222; padding-top: 4px; }
        
        /* Scrollbar estética */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="header"><div class="sig">LIVE ACTIVITY MONITOR</div></div>

    <div id="log-list" class="log-container">
        </div>

    <script>
        // Usamos la misma clave que MyDash para que lean la misma base de datos
        const LG = "VPLAT_V3_LOGS"; 

        async function init() {
            try {
                await OBR.onReady(async () => {
                    // Escuchar cambios globales en la escena
                    OBR.scene.onMetadataChange(m => {
                        const logs = m[LG] || [];
                        renderLogs(logs);
                    });

                    // Carga inicial al abrir la ventana
                    const initialMetadata = await OBR.scene.getMetadata();
                    renderLogs(initialMetadata[LG] || []);
                });
            } catch(e) {
                console.error("No se detectó Owlbear Rodeo");
                document.getElementById('log-list').innerHTML = "<div style='color:red; text-align:center; font-size:12px;'>Error: Abre este addon dentro de Owlbear</div>";
            }
        }

        function renderLogs(logs) {
            const container = document.getElementById('log-list');
            if (logs.length === 0) {
                container.innerHTML = "<div style='text-align:center; color:#444; margin-top:20px; font-size:12px;'>Esperando actividad...</div>";
                return;
            }

            container.innerHTML = logs.map(l => {
                // Limpiar los detalles de etiquetas HTML para que se vean bien
                const cleanDetails = l.details.replace(/<[^>]*>?/gm, '');
                
                return `
                    <div class="log-entry">
                        <div>
                            <span class="dash-name">${l.u}</span> 
                            <span class="formula">[${l.f}]</span>
                            <span class="result-val">➔ ${l.r}</span>
                        </div>
                        <span class="details">Dados: (${cleanDetails})</span>
                    </div>
                `;
            }).join('');
        }

        init();
    </script>
</body>
</html>
